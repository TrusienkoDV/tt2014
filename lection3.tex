\section{Просто типизированное лямбда-исчисление}

\subsection{Импликационный фрагмент интуиционистской логики}

Рассмотрим следующее исчисление, являющееся подмножеством интуиционистской
логики, содержащим только импликацию. Это исчисление генценовского типа.

Формула --- либо маленькая буква греческого алфавита, либо выражение вида
$\phi \rightarrow \psi$, где $\phi$ и $\psi$ - формулы, либо выражение вида $(\phi)$, где $\phi$ - формула.

Аксиомы и правила вывода:

\begin{enumerate}
\item Схема аксиом:
$$\infer{\Gamma, \phi \vdash \phi}{}$$
\item Введение импликации:
$$\infer{\Gamma \vdash \phi \rightarrow \psi}{\Gamma, \phi \vdash \psi}$$
\item Удаление импликации:
$$\infer{\Gamma \vdash \psi}{\Gamma\vdash\phi~~~~~\Gamma\vdash\phi\rightarrow\psi}$$
\end{enumerate}

Следующая теорема покажет, что если некоторая формула (составленная только из
импликаций и переменных) выводима в интуиционистской логике, то она выводима
и в импликационном ее фрагменте.

\begin{theorem}
Модели Крипке корректны и полны для данного исчисления.
\end{theorem}

\begin{proof}
Корректность моделей Крипке для данного исчисления следует из их корректности
для полного исчисления. Для полноты же нам достаточно показать, что если 
неверно $\Gamma\vdash\alpha$, то найдется
модель Крипке, в которой неверно и $\Gamma\models\alpha$. 
Построим такую модель.

В качестве миров в этой модели мы возьмем множества формул, замкнутых относительно
выводимости: $D(\Gamma) = \{ \alpha | \Gamma\vdash\alpha \}$. 
Отношение вынуждения определим так: $\Gamma\Vdash p$, если $p \in \Gamma$.
Наследование же миров будем рассматривать по включению: $\Gamma < \Delta$, если
$\Gamma \in \Delta$.

Покажем, что так заданная модель --- корректна и полна. То есть, 
$\Gamma\vdash\alpha$ тогда и только тогда, когда $\Gamma\Vdash\alpha$. 
Сделаем это индукцией по структуре формулы $\alpha$.

\begin{itemize}
\item $\alpha = x$. Тогда, по определению, $\Gamma\vdash x$ эквивалентно 
$x \in \Gamma$ и эквивалентно $\Gamma\Vdash x$.
\item $\alpha = \beta\rightarrow\gamma$.

Сперва покажем полноту.
Пусть $\Gamma\Vdash\beta\rightarrow\gamma$. Значит (определение вынуждения
импликации в моделях Крипке) $D(\Gamma\cup\beta)\Vdash\gamma$. Раз так, то 
$\Gamma,\beta\vdash\gamma$ (предположение индукции). По правилу введения 
импликации тогда $\Gamma\vdash\beta\rightarrow\gamma$.

Теперь покажем корректность.
Пусть $\Gamma\vdash\beta\rightarrow\gamma$ и в некотором мире 
$\Gamma_n \ge \Gamma$ выполнено $\Gamma_n\Vdash\beta$.
Раз $\Gamma \vdash\beta\rightarrow\gamma$, то $\Gamma_n\vdash\beta\rightarrow\gamma$.
Раз $\Gamma_n\Vdash\beta$, то $\Gamma_n\vdash\beta$ (по полноте, доказанной выше).
Тогда $\Gamma_n\vdash\gamma$ (по правилу удаления импликации), 
и, следовательно, $\Gamma_n\Vdash\gamma$ (по индукционному предположению).
Значит, и $\Gamma_n\Vdash\beta\rightarrow\gamma$.
\end{itemize}

\end{proof}


\subsection{Импликационный фрагмент интуиционистской логики}

Рассмотрим язык интуиционистской логики, в котором допустима только одна связка --- импликация.
Такой язык мы назовем языком импликационного фрагмента интуиционистской логики.

Также, рассмотрим все аксиомы интуиционистского исчисления высказываний, которые можно
записать в этом языке --- они составят аксиомы данного фрагмента логики.

\begin{theorem}
Импликационный фрагмент интуиционистской логики корректен и полон в моделях Крипке.
\end{theorem}

\begin{proof}
Корректность очевидна из корректности интуиционистского исчисления высказываний.

Для доказательства полноты мы построим модель Крипке, в которой мирами будут 
замкнутые относительно доказуемости множества формул.
Очевидно, что для любого такого мира $W$ и любой формулы $\phi$ условия 
$\phi \in W$ и $W \vdash \phi$ эквивалентны.

Будем считать, что $W \Vdash x$ тогда и только тогда, когда $x \in W$. 
Покажем тогда, что это справедливо и для любой формулы $\phi$ (тем самым мы
покажем, что миры действительно образуют модель Крипке).

Докажем это индукцией по структуре формулы $\phi$. База следует из определения,
теперь переход. Т.е., пусть есть формула $\alpha\rightarrow\beta$, 
причём $\alpha\in W$ т.и.т.т., когда $W\Vdash\alpha$, и $\beta\in W$ т.и.т.т., когда $W\Vdash\beta$.

Пусть $W\vdash\alpha\rightarrow\beta$. Покажем, что $W\Vdash\alpha\rightarrow\beta$.
Значит, надо показать, что если $W_1 \ge W$ и $W_1\Vdash\alpha$, то $W_1\Vdash\beta$.
Рассмотрим такой $W_1$. По предположению индукции $W_1\vdash\alpha$, и поскольку 
$W_1\vdash\alpha\rightarrow\beta$ (т.к. $W\subset W_1$), то $W_1\vdash\beta$ (M.P.).
Значит, $W_1\Vdash\beta$ (опять же, по предположению индукции).

Обратно, пусть $W\Vdash\alpha\rightarrow\beta$. Покажем, что $W\vdash\alpha\rightarrow\beta$.
Пусть $W_\alpha$ --- транзитивное замыкание по $\vdash$ множества $W \cup \{\alpha\}$.
Тогда $W_\alpha\Vdash\beta$ (по определению моделей Крипке). Но тогда
$W_\alpha\vdash\beta$ (по предположению индукции). Значит, $W,\alpha\vdash\beta$, то есть
$W\vdash\alpha\rightarrow\beta$ (по т. о дедукции). 

Теперь, пусть $\alpha$ --- формула импликационного фрагмента и $\models\alpha$. Если окажется, 
что $\nvdash\alpha$, то $\nVdash\alpha$ в введенной выше модели, что даст противоречие с $\models\alpha$.
\end{proof}

В этом курсе мы будем рассматривать логику в исчислении Генценовского типа 
(нормальный вывод).

Рассмотрим три правила вывода:

$$\infer[\texttt{аксиома}]{\Gamma,\phi \vdash \phi}{}$$ 

$$\infer[\texttt{введение} \rightarrow]{\Gamma \vdash \phi \rightarrow \psi}{\Gamma,\phi \vdash \psi}$$ 

$$\infer[\texttt{удаление} \rightarrow, \mathrm{M.P.}]{\Gamma\vdash\psi}{\Gamma \vdash \phi\rightarrow\psi \quad \Gamma\vdash\phi}$$ 

\begin{lemma}
Импликационный фрагмент в данном исчислении эквивалентен фрагменту в Гильбертовском исчислении.
\end{lemma}


%Как мы уже убедились из парадокса Карри, лямбда-исчисление --- это слишком мощная 
%конструкция. Чтобы ее упорядочить, нам необходимо каким-то образом 
%ограничить набор выражений, которые корректны. Первая идея на этом
%пути --- ввести типы для всех выражений.

%Идея восходит к типизации теории множеств. Там, чтобы избежать парадоксов,
%можно предложить каждому множеству приписать некоторое значение (тип). Например,
%мы можем приписать пустому множеству тип $0$, множеству, состоящему только из 
%пустого - тип $1$, и вообще, множеству, состоящему из множеств типов $a_1, a_2, \dots$
%тип $Upb_{Ord} \{a_1, a_2, \dots\}$. 

%Здесь мы поступим похоже, только элементарных значений (и, соответственно, 
%типов) у нас будет не одно, а счетное количество.

\begin{definition}
Тип --- это:
\begin{itemize}
\item Элементарный тип --- маленькая греческая буква из начала алфавита, возможно, с индексом ($\alpha, \beta, \dots$)
\item Составной тип. Если $\tau$ и $\sigma$ --- некоторые типы, то запись 
вида $\tau \rightarrow \sigma$ --- это также некоторый тип.
\end{itemize}
Греческими буквами конца алфавита ($\sigma, \dots$) будем обозначать типы вообще, неважно, составные или элементарные.
\end{definition}

Существует два основных стиля типизации лямбда-исчисления --- по Чёрчу и 
по Карри.

\section{Лямбда-исчисление по Чёрчу}

\begin{definition}Пред-лямбда-терм по Чёрчу --- это один из следующих объектов:
\begin{itemize}
\item Переменная ($a,b,c,\dots$)
\item Применение ($\Lambda_1 \Lambda_2$)
\item Абстракция ($\lambda x : \tau . \Lambda$ или $\lambda x^\tau . \Lambda$)
\end{itemize}
\end{definition}

По пред-лямбда-терму можно построить лямбда-терм, введя альфа-эквивалентность аналогично 
бестиповому исчислению (типы должны совпадать).

\section{Лямбда-исчисление по Карри}

Существует второй вариант исчисления.
Главное его отличие --- в отсутствии типов при указании переменных в лямбда-термах.
Правила типизации:
 
Принципиальных отличий нет, легко показать следующую теорему:

\begin{definition}[Стирание] Функцией стирания называется следующая функция: 
	
	$Er: \Lambda_T \rightarrow \Lambda$:
	\[
	Er (A) =
	\begin{cases}
	x                                   & A \equiv x \\
	Er(M) \; Er(N) & A \equiv M \; N \\
	\lambda x . Er(P)           & A \equiv \lambda \; x : \tau. \; P
	\end{cases}
	\]
\end{definition}

\begin{theorem} \
\begin{enumerate}
\item Если $M\rightarrow_\beta N$, то $Er(M)\rightarrow_\beta Er(N)$
\item Если $\Gamma\vdash_\texttt{ч} M:\alpha$, то $\Gamma\vdash_\texttt{к} Er(M):\alpha$.
\end{enumerate}

Поднятие:
\begin{enumerate}
\item Если $M\rightarrow_\beta N$, то для любого $M_T \in \Lambda_T$, такого, что $Er(M_T) = M$,
найдется $N_T \in \Lambda_T$, такой, что $Er(N_T) = T$ и $M_T \rightarrow_\beta N_T$.
\item Если $\Gamma\vdash_\texttt{к} M:\alpha$, то найдется такой $M_T\in\Lambda_T$, 
что $Er(M_T)=M$ и $\Gamma\vdash_\texttt{ч} N:\alpha$.
\end{enumerate}
\end{theorem}

\begin{proof}
Упражнение.
\end{proof}

Также, легко доказать аналоги теорем Черча-Россера и теоремы о нормализации.

Однако, несмотря на сходство, есть и отличие --- типизация по Карри несколько более
широкая. А именно, если $\Gamma\vdash M:\sigma$ и $\Gamma\vdash M:\tau$, 
то из этого не следует $\sigma=\tau$. Скажем, справедливо
$\vdash_\texttt{к}\lambda x.x : \alpha\rightarrow\alpha$ и 
$\vdash_\texttt{к}\lambda x.x : \beta\rightarrow\beta$.

\subsection{Изоморфизм Карри-Ховарда}

Теперь мы готовы показать, что просто типизированное лямбда-исчисление в некотором
смысле изоморфно импликационному фрагменту интуиционистской логики.

Заметим сперва, что $T$ содержит в точности те же формулы, что и введенный в предыдущем
параграфе язык.
                 
\begin{theorem}(Об изоморфизме Карри-Ховарда)
\begin{enumerate}
\item Если $\Gamma \vdash_\texttt{ч} M:\phi$, то $types(\Gamma) \vdash \phi$.
\item Если $\Gamma \vdash \phi$, то найдется такой $M \in \Lambda_T$, что
$\{x_\phi | \phi\in\Gamma\}\vdash_\texttt{ч} M:\phi$.
\end{enumerate}
\end{theorem}

\begin{proof}
Доказательство обоих частей теоремы несложно, но мы приведем доказательство второй части
из методических соображений.

Покажем существование $M$ индукцией по структуре доказательства $\Gamma\vdash\phi$.
Для этого рассмотрим заключительное правило и разберем случаи.

%\begin{itemize}
%\end{itemize}
\end{proof}

\section{Отрицание}

В данном случае нам будет удобнее ввести специальное обозначение для лжи ($\bot$), а отрицание ввести
как формулу $\neg\phi \equiv \phi \rightarrow \bot$. Ложь же мы можем определить следующим образом:
$$\infer{\Gamma\vdash\phi}{\Gamma\vdash\bot}$$

С точки зрения изоморфизма никакой терм не имеет тип $\bot$. Иными словами, если мы доказали, что некоторый
терм имеет тип $\bot$, то значит данный терм не существует. 


Из этого хорошо видно, что изоморфизм 
как раз соответствует интуиционистской, а не классической логике. В самом деле, рассмотрим выражение
$\alpha\vee\neg\alpha$, то есть $\alpha\vee(\alpha\rightarrow\bot)$. Можем ли мы утверждать, что
данный тип всегда обитаем? Если так, то тогда всегда существует лямбда-терм $A: \alpha\vee(\alpha\rightarrow\bot)$.
Однако, непонятно, как такое выражение доказать: функция $\alpha\rightarrow\bot$ в общем случае не 
является обитаемой (она должна возвращать лямбда-выражение, которого нет в природе --- такое возможно только если $\alpha = \bot$).

